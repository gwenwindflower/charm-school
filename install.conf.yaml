- defaults:
    link:
      force: true
      create: true
    shell:
      quiet: true
      stdout: true
    brewfile:
      stdout: true
      stderr: true

- clean: ["~"]

- install-brew: true

- brewfile:
  - Brewfile-fresh-mac
  # - Brewfile-dev-container

- create:
    - ~/.oh-my-zsh/custom/plugins

- link:
    ~/.gitconfig: gitconfig
    ~/.zprofile: zprofile
    ~/.zshrc: zshrc
    ~/.env: env
    ~/.config/starship.toml: starship.toml
    ~/.oh-my-zsh/completions/_dbt: oh-my-zsh/completions/_dbt
    ~/scripts/dbt_scaffolding.sh: scripts/dbt_scaffolding.sh
    ~/.config/kitty: kitty
    ~/.config/nvim: nvim
    ~/.config/karabiner: karabiner

# TODO: install conditional plugin to make this more readable
# TODO: install bun and pnpm
# TODO: install node and npm with nvm after install
- shell:
    - command: if [[ -n "${CODESPACES}" ]] || [[ -n "${GITPOD_WORKSPACE_ID}" ]]; then export IN_DEV_CONTAINER=true; fi
      description: Checking if in a dev container...
    - command: if [[ ${IN_DEV_CONTAINER} ]]; then echo "Don't need to install rust in Codespaces"; elif ! command -v cargo &> /dev/null; then echo "Installing rust" && sh -c "$(curl -o- https://sh.rustup.rs)" -y -f; else echo "Already installed rust"; fi
      description: Checking  rust install...
    - command: git submodule update --init --recursive
      description: Installing git submodules...
    - command: source ~/.zshrc; if [[ ${IN_DEV_CONTAINER} ]]; then echo "Don't need nvm in Codespaces"; elif ! command -v nvm &> /dev/null; then echo "Installing nvm" && sh -c "$(curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.37.2/install.sh)" -y -f; else echo "Already installed nvm"; fi
      description: Checking  nvm install...
    - command: if [ -z "${ZSH+x}" ] && ! command -v omz &> /dev/null; then echo "Installing oh-my-zsh..."; sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"; else echo "Already installed oh-my-zsh"; fi
      description: Checking oh-my-zsh install...
    - command: git -C ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions pull || git clone https://github.com/zsh-users/zsh-autosuggestions.git ~/.oh-my-zsh/custom/plugins/zsh-autosuggestions
      description: Installing or updating zsh-autosuggestions
    - command: git -C ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting pull || git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ~/.oh-my-zsh/custom/plugins/zsh-syntax-highlighting
      description: Installing or updating zsh-syntax-highlighting
    - command: defaults write com.microsoft.VSCode ApplePressAndHoldEnabled -bool false
      description: Enabling key-repeat for vim mode in VSCode
